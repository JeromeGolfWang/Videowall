<!doctype html>
loading = true;
const next = items.slice(cursor, cursor + CONFIG.BATCH);
cursor += next.length;
if (!next.length) { loading = false; return; }
// weâ€™re not fetching metadata here; just render
next.forEach(addCard);
loading = false;
}


function addCard(item){
const card = document.createElement('article');
card.className = 'card';
const media = document.createElement('div');
media.className = 'media';


if (item.poster){
const img = document.createElement('img');
img.src = item.poster; media.appendChild(img);
}


const info = document.createElement('div');
info.className = 'info';
info.textContent = item.title || filename(item.src);


card.appendChild(media); card.appendChild(info); grid.appendChild(card);
card.dataset.src = item.src; card.dataset.poster = item.poster || '';
io.observe(card);
}


const io = new IntersectionObserver((entries) => {
for (const e of entries){ if (!e.isIntersecting) continue; io.unobserve(e.target); mountVideo(e.target); }
}, { rootMargin: '1200px 0px' });


function mountVideo(card){
const media = card.querySelector('.media');
const v = document.createElement('video');
v.setAttribute('playsinline',''); v.setAttribute('preload','none'); v.controls = true;
if (CONFIG.AUTOPLAY) v.autoplay = true; if (CONFIG.MUTED) v.muted = true;
const src = document.createElement('source'); src.src = card.dataset.src; src.type = 'video/mp4';
v.appendChild(src); media.innerHTML = ''; media.appendChild(v);
}


window.addEventListener('scroll', () => {
const nearBottom = window.innerHeight + window.scrollY > document.body.offsetHeight - 1600;
if (nearBottom) enqueue();
});


function filename(p){ try{ return decodeURIComponent(p.split('/').pop()); } catch{ return p; } }
</script>
</body>
</html>